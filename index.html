<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Å ifrovanÃ½ sprÃ¡vce hesel | HvÄ›zdnÃ¡ flotila</title>
    
    <!-- PouÅ¾ij datum poslednÃ­ho commitu -->
<link rel="stylesheet" href="style.css?v=20241215">

    <!-- PÅ™idÃ¡nÃ­ defer ke vÅ¡em scriptÅ¯m -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script defer src="script.js"></script>
<script defer src="firebase-logic.js"></script>
</head>
<body>

    <div id="fleetToast" class="toast-notification"></div>

    <div id="loginForm" class="login-container container hidden">
        <h1>ğŸš€ HvÄ›zdnÃ¡ flotila - PÅ™Ã­stup</h1>
        <p>Pro synchronizaci hesel mezi zaÅ™Ã­zenÃ­mi se pÅ™ihlaste pÅ™es Google.</p>
        <button onclick="signInWithGoogle()" style="background-color: #DB4437; color: white;" title="PÅ™ihlÃ¡sit se pomocÃ­ Google ÃºÄtu">ğŸŒ PÅ™ihlÃ¡sit pÅ™es Google</button>
    </div>

    <div id="mainContent" class="container hidden">
        <button class="logout-btn" onclick="confirmLogout()" title="OdhlÃ¡sit se z aplikace">ğŸ”¥ OdhlÃ¡sit se</button>
        <h1>ğŸ” Å ifrovanÃ½ sprÃ¡vce hesel</h1>
        
        <div class="form-group">
            <label for="service" title="NÃ¡zev sluÅ¾by nebo webu">SluÅ¾ba:</label>
            <input type="text" id="service" placeholder="napÅ™. Google, Facebook, GitHub..." title="Zadejte nÃ¡zev sluÅ¾by">
        </div>
        
        <div class="form-group">
            <label for="username" title="UÅ¾ivatelskÃ© jmÃ©no nebo e-mail">UÅ¾ivatelskÃ© jmÃ©no:</label>
            <input type="text" id="username" placeholder="napÅ™. admiral@starfleet.com" title="Zadejte uÅ¾ivatelskÃ© jmÃ©no">
        </div>
        
        <div class="form-group">
            <label for="password" title="Heslo pro danou sluÅ¾bu">Heslo:</label>
            <div class="password-input-group">
                <input type="password" id="password" placeholder="Zadejte heslo..." title="Zadejte heslo">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('password', this)" title="PÅ™epnout viditelnost hesla">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <div class="button-group">
    <button onclick="savePassword()" title="UloÅ¾it heslo do databÃ¡ze">ğŸ’¾ ULOÅ½IT</button>
    <button class="export-btn" onclick="exportToTxt()" title="StÃ¡hnout vÅ¡echna hesla jako TXT soubor">ğŸ“¤ EXPORT</button>
    <button class="import-btn" onclick="triggerImport()" title="NahrÃ¡t hesla z TXT souboru">ğŸ“¥ IMPORT</button>
    <input type="file" id="importFile" class="file-input" accept=".txt" onchange="importFromTxt(event)">
</div>
        
        <div id="passwordTableContainer">
            <table id="passwordTable">
                <thead><tr><th>SluÅ¾ba</th><th>UÅ¾ivatel</th><th>Heslo</th><th>Akce</th></tr></thead>
                <tbody></tbody>
            </table>
            <div id="emptyState" class="empty-state hidden">
                <div class="empty-state-icon">ğŸ›¸</div>
                <p><strong>ZatÃ­m Å¾Ã¡dnÃ¡ uloÅ¾enÃ¡ hesla</strong></p>
                <p>ZaÄnÄ›te pÅ™idÃ¡nÃ­m prvnÃ­ho hesla pomocÃ­ formulÃ¡Å™e vÃ½Å¡e!</p>
            </div>
        </div>
    </div>

    <!-- ğŸš€ ROZÅ ÃÅ˜ENÃ‰ MODALY PRO MASTER KEY SYSTÃ‰M ğŸš€ -->
<!-- NahraÄ pÅ¯vodnÃ­ masterKeyInputModal tÃ­mto kompletnÃ­m blokem -->

<!-- ========================================== -->
<!-- 1ï¸âƒ£ HLAVNÃ MASTER KEY MODAL (PÅ˜IHLÃÅ ENÃ) -->
<!-- ========================================== -->
<div id="masterKeyInputModal" class="masterkey-modal-overlay hidden">
    <div class="masterkey-modal-content">
        <p id="masterKeyInputModalMessage" class="masterkey-modal-message"></p>
        
        <!-- Master heslo input -->
        <div class="form-group">
            <label for="masterKeyInputField">Master heslo:</label>
            <div class="password-input-group">
                <input type="password" id="masterKeyInputField" placeholder="Zadejte master heslo" title="Master heslo pro Å¡ifrovÃ¡nÃ­ vÅ¡ech dat">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('masterKeyInputField', this)" title="PÅ™epnout viditelnost master hesla">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- PIN input (zobrazÃ­ se po zadÃ¡nÃ­ master hesla) -->
        <div class="form-group" id="pinInputGroup" style="display:none;">
            <label for="pinInputField">PIN (4-6 ÄÃ­slic):</label>
            <div class="password-input-group">
                <input type="password" id="pinInputField" maxlength="6" pattern="[0-9]*" inputmode="numeric" placeholder="Zadejte PIN" title="BezpeÄnostnÃ­ PIN">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('pinInputField', this)" title="PÅ™epnout viditelnost PIN">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- TlaÄÃ­tka -->
        <div class="masterkey-modal-buttons">
            <button class="confirm-ok" onclick="handleMasterKeyInput()" title="Potvrdit a pokraÄovat">âœ… Potvrdit</button>
            
            <!-- TlaÄÃ­tko "ZmÄ›nit heslo" - zobrazÃ­ se po pÅ™ihlÃ¡Å¡enÃ­ -->
            <button class="change-password-btn" onclick="showChangePasswordModal()" id="changeMasterPasswordBtn" style="display:none;" title="ZmÄ›nit master heslo">
                ğŸ”‘ ZmÄ›nit heslo
            </button>
            
            <!-- TlaÄÃ­tko "ZapomnÄ›l jsem heslo" -->
            <button class="recovery-btn" onclick="showRecoveryModal()" id="recoveryBtn" title="Obnovit pÅ™Ã­stup pomocÃ­ backup key">
                ğŸ†˜ ZapomnÄ›l jsem heslo
            </button>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- 2ï¸âƒ£ SETUP BACKUP & PIN (PRO NOVÃ‰ UÅ½IVATELE) -->
<!-- ========================================== -->
<div id="setupBackupModal" class="masterkey-modal-overlay hidden">
    <div class="masterkey-modal-content">
        <h2 style="color: var(--accent-color); text-align: center; margin-bottom: 20px;">ğŸ›¡ï¸ NastavenÃ­ zÃ¡lohy</h2>
        
        <div class="info-box warning" style="background: rgba(255, 152, 0, 0.1); border: 1px solid var(--warning-color); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <p style="margin: 0; color: var(--text-primary);">
                <strong>âš ï¸ DÅ®LEÅ½ITÃ‰:</strong> VytvoÅ™ backup key a PIN pro pÅ™Ã­pad ztrÃ¡ty master hesla.
            </p>
            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: var(--text-secondary);">
                Backup key ti umoÅ¾nÃ­ obnovit pÅ™Ã­stup k tvÃ½m heslÅ¯m, pokud zapomeneÅ¡ master heslo. ZapiÅ¡ si ho na bezpeÄnÃ© mÃ­sto!
            </p>
        </div>
        
        <!-- Backup Key -->
        <div class="form-group">
            <label for="setupBackupKey">Backup Key (12+ znakÅ¯):</label>
            <div class="password-input-group">
                <input type="password" id="setupBackupKey" placeholder="VytvoÅ™ silnÃ½ backup key" title="ZÃ¡loÅ¾nÃ­ klÃ­Ä pro recovery">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('setupBackupKey', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
            <small style="color: var(--text-secondary); font-size: 0.85em;">âš ï¸ ZapiÅ¡ si ho na bezpeÄnÃ© mÃ­sto (papÃ­r, trezor)!</small>
        </div>
        
        <!-- PotvrzenÃ­ Backup Key -->
        <div class="form-group">
            <label for="confirmSetupBackupKey">Potvrdit Backup Key:</label>
            <div class="password-input-group">
                <input type="password" id="confirmSetupBackupKey" placeholder="Zadej backup key znovu" title="PotvrzenÃ­ backup key">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmSetupBackupKey', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <div style="height: 20px;"></div>
        
        <!-- PIN -->
        <div class="form-group">
            <label for="setupPin">PIN (4-6 ÄÃ­slic):</label>
            <div class="password-input-group">
                <input type="password" id="setupPin" maxlength="6" pattern="[0-9]*" inputmode="numeric" placeholder="NapÅ™. 1234" title="BezpeÄnostnÃ­ PIN">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('setupPin', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
            <small style="color: var(--text-secondary); font-size: 0.85em;">PouÅ¾Ã­vÃ¡ se pÅ™i zmÄ›nÄ› hesla a recovery</small>
        </div>
        
        <!-- PotvrzenÃ­ PIN -->
        <div class="form-group">
            <label for="confirmSetupPin">Potvrdit PIN:</label>
            <div class="password-input-group">
                <input type="password" id="confirmSetupPin" maxlength="6" pattern="[0-9]*" inputmode="numeric" placeholder="Zadej PIN znovu" title="PotvrzenÃ­ PIN">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmSetupPin', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- TlaÄÃ­tka -->
        <div class="masterkey-modal-buttons">
            <button class="confirm-ok" onclick="completeBackupSetup()" title="DokonÄit nastavenÃ­ zÃ¡lohy">
                âœ… DokonÄit setup
            </button>
        </div>
        
        <div class="info-box info" style="background: rgba(33, 150, 243, 0.1); border: 1px solid #2196F3; padding: 10px; border-radius: 8px; margin-top: 15px;">
            <small style="color: var(--text-secondary); font-size: 0.85em;">
                ğŸ’¡ <strong>Tip:</strong> Backup key a PIN jsou jednorÃ¡zovÄ› nastaveny. ZmÄ›nit je mÅ¯Å¾eÅ¡ pouze vytvoÅ™enÃ­m novÃ©ho ÃºÄtu.
            </small>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- 3ï¸âƒ£ ZMÄšNA MASTER HESLA -->
<!-- ========================================== -->
<div id="changePasswordModal" class="masterkey-modal-overlay hidden">
    <div class="masterkey-modal-content">
        <h2 style="color: var(--accent-color); text-align: center; margin-bottom: 20px;">ğŸ”‘ ZmÄ›na master hesla</h2>
        
        <div class="info-box info" style="background: rgba(33, 150, 243, 0.1); border: 1px solid #2196F3; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <p style="margin: 0; color: var(--text-primary);">
                <strong>â„¹ï¸ INFO:</strong> ZmÄ›na master hesla znovu zaÅ¡ifruje vÅ¡echna tvoje hesla.
            </p>
            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: var(--text-secondary);">
                Backup key zÅ¯stane stejnÃ½ a slouÅ¾Ã­ jako zÃ¡loha pro pÅ™Ã­pad zapomenutÃ­ novÃ©ho hesla.
            </p>
        </div>
        
        <!-- StarÃ© master heslo -->
        <div class="form-group">
            <label for="oldMasterPassword">StarÃ© master heslo:</label>
            <div class="password-input-group">
                <input type="password" id="oldMasterPassword" placeholder="Zadej souÄasnÃ© master heslo" title="SouÄasnÃ© master heslo">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('oldMasterPassword', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- PIN pro ovÄ›Å™enÃ­ -->
        <div class="form-group">
            <label for="changePinVerify">PIN pro ovÄ›Å™enÃ­:</label>
            <div class="password-input-group">
                <input type="password" id="changePinVerify" maxlength="6" pattern="[0-9]*" inputmode="numeric" placeholder="Zadej svÅ¯j PIN" title="BezpeÄnostnÃ­ PIN">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('changePinVerify', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <div style="height: 20px; border-top: 1px solid rgba(0, 204, 255, 0.2); margin: 20px 0;"></div>
        
        <!-- NovÃ© master heslo -->
        <div class="form-group">
            <label for="newMasterPassword">NovÃ© master heslo:</label>
            <div class="password-input-group">
                <input type="password" id="newMasterPassword" placeholder="VytvoÅ™ novÃ© silnÃ© heslo" title="NovÃ© master heslo">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('newMasterPassword', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
            <small style="color: var(--text-secondary); font-size: 0.85em;">MinimÃ¡lnÄ› 12 znakÅ¯, mix pÃ­smen, ÄÃ­slic a symbolÅ¯</small>
        </div>
        
        <!-- PotvrzenÃ­ novÃ©ho hesla -->
        <div class="form-group">
            <label for="confirmNewMasterPassword">Potvrdit novÃ© heslo:</label>
            <div class="password-input-group">
                <input type="password" id="confirmNewMasterPassword" placeholder="Zadej novÃ© heslo znovu" title="PotvrzenÃ­ novÃ©ho hesla">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmNewMasterPassword', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- TlaÄÃ­tka -->
        <div class="masterkey-modal-buttons">
            <button class="confirm-ok" onclick="changeMasterPassword()" title="Potvrdit zmÄ›nu hesla">
                âœ… ZmÄ›nit heslo
            </button>
            <button class="cancel-btn" onclick="closeChangePasswordModal()" title="ZruÅ¡it a vrÃ¡tit se">
                âŒ ZruÅ¡it
            </button>
        </div>
        
        <div class="info-box warning" style="background: rgba(255, 152, 0, 0.1); border: 1px solid var(--warning-color); padding: 10px; border-radius: 8px; margin-top: 15px;">
            <small style="color: var(--text-secondary); font-size: 0.85em;">
                âš ï¸ <strong>UpozornÄ›nÃ­:</strong> Tato operace mÅ¯Å¾e trvat nÄ›kolik sekund. NezavÃ­rej prohlÃ­Å¾eÄ bÄ›hem zmÄ›ny!
            </small>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- 4ï¸âƒ£ RECOVERY MODAL (ZAPOMENUTÃ‰ HESLO) -->
<!-- ========================================== -->
<div id="recoveryModal" class="masterkey-modal-overlay hidden">
    <div class="masterkey-modal-content">
        <h2 style="color: var(--danger-color); text-align: center; margin-bottom: 20px;">ğŸ†˜ Obnova pÅ™Ã­stupu</h2>
        
        <div class="info-box warning" style="background: rgba(244, 67, 54, 0.1); border: 1px solid var(--danger-color); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <p style="margin: 0; color: var(--text-primary);">
                <strong>âš ï¸ POZOR:</strong> ZapomnÄ›l jsi master heslo?
            </p>
            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: var(--text-secondary);">
                MÅ¯Å¾eÅ¡ obnovit pÅ™Ã­stup pomocÃ­ <strong>backup key</strong> a <strong>PIN</strong>. Po obnovÄ› budeÅ¡ muset vytvoÅ™it novÃ© master heslo.
            </p>
        </div>
        
        <!-- Backup Key -->
        <div class="form-group">
            <label for="recoveryBackupKey">Backup Key:</label>
            <div class="password-input-group">
                <input type="password" id="recoveryBackupKey" placeholder="Zadej svÅ¯j backup key" title="ZÃ¡loÅ¾nÃ­ klÃ­Ä pro recovery">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('recoveryBackupKey', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
            <small style="color: var(--text-secondary); font-size: 0.85em;">Ten, kterÃ½ jsi si zapsal pÅ™i setupu</small>
        </div>
        
        <!-- PIN -->
        <div class="form-group">
            <label for="recoveryPin">PIN:</label>
            <div class="password-input-group">
                <input type="password" id="recoveryPin" maxlength="6" pattern="[0-9]*" inputmode="numeric" placeholder="Zadej svÅ¯j PIN" title="BezpeÄnostnÃ­ PIN">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('recoveryPin', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- TlaÄÃ­tka -->
        <div class="masterkey-modal-buttons">
            <button class="confirm-ok" onclick="recoverAccess()" title="Obnovit pÅ™Ã­stup pomocÃ­ backup key">
                âœ… Obnovit pÅ™Ã­stup
            </button>
            <button class="cancel-btn" onclick="closeRecoveryModal()" title="ZruÅ¡it a vrÃ¡tit se">
                âŒ ZruÅ¡it
            </button>
        </div>
        
        <div class="info-box danger" style="background: rgba(244, 67, 54, 0.1); border: 1px solid var(--danger-color); padding: 10px; border-radius: 8px; margin-top: 15px;">
            <small style="color: var(--text-secondary); font-size: 0.85em;">
                ğŸ”’ <strong>NemÃ¡Å¡ backup key ani PIN?</strong> Bez nich bohuÅ¾el nelze obnovit pÅ™Ã­stup k zaÅ¡ifrovanÃ½m heslÅ¯m. BudeÅ¡ muset vytvoÅ™it novÃ½ ÃºÄet.
            </small>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- 5ï¸âƒ£ NOVÃ‰ MASTER HESLO PO RECOVERY -->
<!-- ========================================== -->
<div id="newMasterPasswordModal" class="masterkey-modal-overlay hidden">
    <div class="masterkey-modal-content">
        <h2 style="color: var(--success-color); text-align: center; margin-bottom: 20px;">âœ… PÅ™Ã­stup obnoven!</h2>
        
        <div class="info-box success" style="background: rgba(76, 175, 80, 0.1); border: 1px solid var(--success-color); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <p style="margin: 0; color: var(--text-primary);">
                <strong>ğŸ‰ ÃšspÄ›ch!</strong> Tvoje hesla byla ÃºspÄ›Å¡nÄ› deÅ¡ifrovÃ¡na.
            </p>
            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: var(--text-secondary);">
                NynÃ­ vytvoÅ™ novÃ© master heslo pro zabezpeÄenÃ­ tvÃ½ch dat.
            </p>
        </div>
        
        <!-- NovÃ© master heslo -->
        <div class="form-group">
            <label for="recoveryNewMasterPassword">NovÃ© master heslo:</label>
            <div class="password-input-group">
                <input type="password" id="recoveryNewMasterPassword" placeholder="VytvoÅ™ novÃ© silnÃ© heslo" title="NovÃ© master heslo">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('recoveryNewMasterPassword', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
            <small style="color: var(--text-secondary); font-size: 0.85em;">MinimÃ¡lnÄ› 12 znakÅ¯, mix pÃ­smen, ÄÃ­slic a symbolÅ¯</small>
        </div>
        
        <!-- PotvrzenÃ­ novÃ©ho hesla -->
        <div class="form-group">
            <label for="recoveryConfirmNewMasterPassword">Potvrdit novÃ© heslo:</label>
            <div class="password-input-group">
                <input type="password" id="recoveryConfirmNewMasterPassword" placeholder="Zadej novÃ© heslo znovu" title="PotvrzenÃ­ novÃ©ho hesla">
                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('recoveryConfirmNewMasterPassword', this)" title="PÅ™epnout viditelnost">ğŸ”’ Zobrazit</button>
            </div>
        </div>
        
        <!-- TlaÄÃ­tka -->
        <div class="masterkey-modal-buttons">
            <button class="confirm-ok" onclick="setNewMasterPasswordAfterRecovery()" title="Nastavit novÃ© master heslo">
                âœ… Nastavit novÃ© heslo
            </button>
        </div>
        
        <div class="info-box warning" style="background: rgba(255, 152, 0, 0.1); border: 1px solid var(--warning-color); padding: 10px; border-radius: 8px; margin-top: 15px;">
            <small style="color: var(--text-secondary); font-size: 0.85em;">
                ğŸ’¡ <strong>Tip:</strong> TentokrÃ¡t si zapiÅ¡ novÃ© heslo na bezpeÄnÃ© mÃ­sto!
            </small>
        </div>
    </div>
</div>

     <footer id="appFooter" class="hidden">
  &copy; <span id="currentYear"></span> Å ifrovanÃ½ sprÃ¡vce hesel | VÃ­ce admirÃ¡l jiÅ™Ã­k & AdmirÃ¡l Claude.ai
</footer>

</body>

</html>
